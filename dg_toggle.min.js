dg.createModule("dg_toggle"),dg._toggles={},DgToggle=function(t){if(this._variables=t,t._state||(t._state="off"),t._mode||(t._mode="waiting"),t._off){var e=t._off;e.waiting&&dg.attributesInit(e.waiting),e.working&&dg.attributesInit(e.working)}if(t._on){var g=t._on;g.waiting&&dg.attributesInit(g.waiting),g.working&&dg.attributesInit(g.working)}},DgToggle.prototype.getVariables=function(){return this._variables},DgToggle.prototype.id=function(){return this.getVariables()._attributes.id},DgToggle.prototype.getState=function(){return this.getVariables()._state},DgToggle.prototype.setState=function(t){this.getVariables()._state=t},DgToggle.prototype.getOppositeState=function(){return"on"==this.getState()?"off":"on"},DgToggle.prototype.getMode=function(){return this.getVariables()._mode},DgToggle.prototype.setMode=function(t){this.getVariables()._mode=t},DgToggle.prototype.getOppositeMode=function(){return this.isWorking()?"waiting":"working"},DgToggle.prototype.getWorker=function(){return this.getVariables()._worker},DgToggle.prototype.getButton=function(t,e){t||(t=this.getState()),e||(e=this.getMode());var g=this.getVariables()["_"+t][e],i=g._attributes;return i.id||(i.id=this.id()),i.onclick||(i.onclick="dg_toggle.onclick(this)"),g},DgToggle.prototype.html=function(){var t=this.getButton();return t._attributes=dg.extend(this.getVariables()._attributes,t._attributes),dg.render(t)},DgToggle.prototype.refresh=function(){var t=dg.qs("#"+this.id()),e=this.getButton();e._attributes=dg.extend(this.getVariables()._attributes,e._attributes),dg.addAttrs(t,e),t.innerHTML=e._value},DgToggle.prototype.isWorking=function(){return"working"==this.getMode()},DgToggle.prototype.turningOn=function(){return"off"==this.getState()&&this.isWorking()},DgToggle.prototype.turningOff=function(){return"on"==this.getState()&&this.isWorking()},dg_toggle.create=function(t){var e=t._attributes;e.id||(e.id="toggle-"+dg.salt());var g=e.id;return dg._toggles[g]=new DgToggle(t),dg._toggles[g]},dg_toggle.load=function(t){return dg._toggles[t]?dg._toggles[t]:null},dg_toggle.onclick=function(t){var e=t.getAttribute("id"),g=dg_toggle.load(e);if(g&&!g.isWorking()){var i=function(){g.setState(g.getOppositeState()),g.setMode("waiting"),g.refresh()};g.setMode("working"),g.refresh();var o=g.getWorker()(g,t);o?jDrupal.isPromise(o)?o.then(i):i():(g.setMode("waiting"),g.refresh())}},dg.theme_toggle=function(t){var e=dg_toggle.create(t);return e?e.html():""};